# Map / Set vs Object / Array + WeakMap / WeakSet

## Зачем это нужно

Выбор правильной структуры данных влияет на:
- производительность
- читаемость кода
- корректность логики (утечки памяти, неожиданные ключи)

На собеседованиях часто спрашивают:
- почему иногда лучше Map, а не Object
- чем Set отличается от Array
- зачем нужны WeakMap и WeakSet

---

## Object vs Map

### Object

```js
const obj = {};
obj["key"] = 1;
```

Особенности:
- ключи приводятся к строкам (кроме Symbol)
- есть прототип (может мешать)
- порядок ключей не гарантирован логически (хотя спецификация его описывает)

---

### Map

```js
const map = new Map();
map.set({ a: 1 }, "value");
```

Плюсы Map:
- ключом может быть **любой тип**
- нет конфликтов с prototype
- предсказуемый порядок вставки
- удобные методы: `set`, `get`, `has`, `delete`

Когда использовать:
- ключи — объекты
- важна частая вставка/удаление
- нужна явная семантика «словаря»

---

## Array vs Set

### Array

```js
const arr = [1, 2, 2, 3];
```

Особенности:
- допускает дубликаты
- поиск — O(n)
- порядок важен

---

### Set

```js
const set = new Set([1, 2, 2, 3]); // {1,2,3}
```

Плюсы Set:
- только уникальные значения
- быстрые операции `has`, `add`, `delete`
- удобен для дедупликации

Когда использовать:
- важна уникальность
- частые проверки наличия

---

## WeakMap и WeakSet

### Ключевая идея

**WeakMap / WeakSet не удерживают объекты в памяти**.

Если на объект больше нет сильных ссылок — он может быть удалён GC.

---

### WeakMap

```js
const wm = new WeakMap();
let obj = {};

wm.set(obj, "data");
obj = null; // объект может быть собран GC
```

Особенности:
- ключи — только объекты
- нельзя итерироваться
- используется для приватных данных, кэшей

---

### WeakSet

```js
const ws = new WeakSet();
const obj = {};

ws.add(obj);
```

Особенности:
- хранит только объекты
- нет итерации
- используется для пометок, флагов

---

## Типовые ловушки

### Ловушка 1 — Object как Map

```js
const cache = {};
cache[obj] = "value"; // ключ станет "[object Object]"
```

❌ Ошибка.

---

### Ловушка 2 — утечки памяти

Map удерживает ключи.
WeakMap — нет.

Для кэшей и метаданных → **WeakMap**.

---

## Как отвечать на собеседовании

1. Object — простая структура, строки/символы как ключи
2. Map — универсальный словарь с любыми ключами
3. Set — коллекция уникальных значений
4. WeakMap / WeakSet — не мешают GC
5. Примеры практического применения

---

## Вопросы для самопроверки

1. Почему Object — не всегда словарь?
2. Когда Map лучше Object?
3. Зачем нужен Set?
4. Почему WeakMap нельзя итерировать?
5. В чём разница хранения ссылок в Map и WeakMap?

---

## Связанные темы

- Garbage Collection
- Производительность
- Кэширование
- Структуры данных
