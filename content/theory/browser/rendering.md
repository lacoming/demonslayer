# Как браузер рендерит страницу (Rendering Pipeline)

## Зачем это нужно

Понимание рендеринга браузера — критично для фронтенд-разработчика уровня Middle.
Эта тема объясняет:
- почему сайт «тормозит»
- откуда берутся CLS и мигания
- почему одни CSS-свойства дорогие, а другие — нет
- как писать производительный UI

На собеседованиях это одна из **ключевых тем по браузеру**.

---

## Общая схема рендеринга

После получения HTML браузер проходит следующие этапы:

1. **Parsing HTML → DOM**
2. **Parsing CSS → CSSOM**
3. **Render Tree**
4. **Layout (Reflow)**
5. **Paint**
6. **Compositing**

Важно:
> Не каждое изменение проходит все этапы.

---

## 1. DOM (Document Object Model)

HTML парсится сверху вниз и превращается в DOM-дерево.

Особенности:
- блокирующий процесс
- `<script>` без `defer/async` останавливает парсинг

---

## 2. CSSOM

CSS парсится в отдельное дерево — CSSOM.

Особенности:
- CSS **блокирует рендер**
- браузер не может построить Render Tree без CSSOM

---

## 3. Render Tree

Render Tree = DOM + CSSOM, но:
- без `display: none`
- только визуальные узлы

---

## 4. Layout (Reflow)

Этап вычисления:
- размеров элементов
- их положения на странице

Триггеры layout:
- изменение размеров
- изменение шрифтов
- изменение DOM

❗ Layout — дорогая операция.

---

## 5. Paint

Отрисовка:
- цветов
- текста
- теней
- границ

Paint рисует **пиксели**, но не собирает слои.

---

## 6. Compositing

Финальный этап:
- сборка слоёв
- GPU-оптимизация
- transform / opacity работают здесь

---

## Layout vs Paint vs Composite

| Изменение | Layout | Paint | Composite |
|----------|--------|-------|-----------|
| width | ✅ | ✅ | ❌ |
| color | ❌ | ✅ | ❌ |
| transform | ❌ | ❌ | ✅ |

---

## Типовые ловушки

### Ловушка 1 — layout thrashing

Чередование чтения и записи layout:

```js
el.style.width = el.offsetWidth + 10 + "px";
```

---

### Ловушка 2 — анимация через top/left

Лучше:
```css
transform: translateX()
```

---

## Как отвечать на собеседовании

1. DOM и CSSOM строятся отдельно
2. Затем Render Tree
3. Layout → Paint → Composite
4. Layout самый дорогой
5. transform и opacity — самые дешёвые

---

## Вопросы для самопроверки

1. Почему CSS блокирует рендер?
2. Чем layout отличается от paint?
3. Какие свойства триггерят reflow?
4. Почему transform быстрее?
5. Что такое layout thrashing?

---

## Связанные темы

- Performance metrics (LCP, CLS)
- requestAnimationFrame
- CSS optimization
